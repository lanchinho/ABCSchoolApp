@page "/tenants"
@using ABCShared.Library.Constants

@attribute [ShouldHavePermission(SchoolAction.Read, SchoolFeature.Tenants)]

<Header OnReturn="ReturnClicked" Title="Tenants" Description="Manage Tenants" />

<MudTable Items="TenantList"
		  Loading="_isLoading"
		  LoadingProgressColor="Color.Info"
		  Elevation="25">
	<ToolBarContent>
		<MudFab StartIcon="@Icons.Material.Filled.Add"
				IconSize="Size.Medium"
				OnClick="OnBoardNewTenantAsync"
				Size="Size.Small"
				Class="mr-2" />
	</ToolBarContent>
	<HeaderContent>
		<MudTh>Tenant</MudTh>
		<MudTh>Admin. First Name</MudTh>
		<MudTh>Admin. Last Name</MudTh>
		<MudTh>E-mail</MudTh>
		<MudTh>Expiry Date</MudTh>
		<MudTh>Active</MudTh>
		<MudTh>Actions</MudTh>
	</HeaderContent>
	<RowTemplate>
		<MudTd>@context.Identifier</MudTd>
		<MudTd>@context.Name</MudTd>
		<MudTd>@context.LastName</MudTd>
		<MudTd>@context.Email</MudTd>
		<MudTd>@context.ValidUpTo.ToString("dd/MM/yyyy")</MudTd>
		<MudTd>
			<MudCheckBox @bind-Value="@context.IsActive"
						 ReadOnly
						 Color="Color.Secondary" />
		</MudTd>
		<MudTd>
			<MudMenu Icon="@Icons.Material.Filled.MoreVert"
					 Size="Size.Small"
					 Color="Color.Secondary"
					 TransformOrigin="Origin.TopLeft"
					 AnchorOrigin="Origin.TopLeft">
				<MudMenuItem OnClick="@(() => UpgradeSubscriptionAsync(context))">Upgrade</MudMenuItem>
				@if (context.IsActive)
				{
					<MudMenuItem OnClick="@(() => ChangeStatusAsync(context))">Deactivate</MudMenuItem>
				}
				else
				{
					<MudMenuItem OnClick="@(() => ChangeStatusAsync(context))">Activate</MudMenuItem>
				}
			</MudMenu>
		</MudTd>
	</RowTemplate>
	<PagerContent>
		<MudTablePager RowsPerPageString="RowsPerPageString" InfoFormat="InfoFormat" />
	</PagerContent>
</MudTable>
